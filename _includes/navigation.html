{% assign current_lang = page.lang | default: 'en' %}
{% if current_lang == 'zh' %}
  {% assign lang_prefix = '/zh' %}
{% else %}
  {% assign lang_prefix = '' %}
{% endif %}

{% comment %}
Logic for page-specific language switching:
1. Determine the 'base' path of the current page (e.g. '/research/') without the lang prefix.
2. If current page is home ('/' or '/zh/'), base path is '/'.
3. Construct the target URLs:
   - EN target: base path (e.g. '/research/')
   - ZH target: '/zh' + base path (e.g. '/zh/research/')
{% endcomment %}

{% assign page_url = page.url %}
{% if current_lang == 'zh' %}
  {% if page_url == '/zh/' %}
    {% assign base_path = '/' %}
  {% else %}
    {% assign base_path = page_url | remove_first: '/zh' %}
  {% endif %}
{% else %}
  {% assign base_path = page_url %}
{% endif %}

{% assign en_url = base_path %}
{% if base_path == '/' %}
  {% assign zh_url = '/zh/' %}
{% else %}
  {% assign zh_url = '/zh' | append: base_path %}
{% endif %}

<nav class="main-nav">
    <div class="nav-container">
        <ul class="nav-list">
            <li><a href="{{ (lang_prefix | append: '/') | relative_url }}" {% if page.url == '/' or page.url == '/zh/' %}class="active"{% endif %}>{% if current_lang == 'zh' %}首页{% else %}Home{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/research/') | relative_url }}" {% if page.url contains '/research' %}class="active"{% endif %}>{% if current_lang == 'zh' %}研究{% else %}Research{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/leaders/') | relative_url }}" {% if page.url contains '/leaders' %}class="active"{% endif %}>{% if current_lang == 'zh' %}领军团队{% else %}Leaders{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/team/') | relative_url }}" {% if page.url contains '/team' %}class="active"{% endif %}>{% if current_lang == 'zh' %}团队{% else %}Team{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/publications/') | relative_url }}" {% if page.url contains '/publications' %}class="active"{% endif %}>{% if current_lang == 'zh' %}论文{% else %}Publications{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/news/') | relative_url }}" {% if page.url contains '/news' %}class="active"{% endif %}>{% if current_lang == 'zh' %}新闻{% else %}News{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/photos/') | relative_url }}" {% if page.url contains '/photos' %}class="active"{% endif %}>{% if current_lang == 'zh' %}照片{% else %}Photos{% endif %}</a></li>
            <li><a href="{{ (lang_prefix | append: '/contact/') | relative_url }}" {% if page.url contains '/contact' %}class="active"{% endif %}>{% if current_lang == 'zh' %}联系{% else %}Contact{% endif %}</a></li>
        </ul>
        <div class="lang-switch nav-lang">
            <a class="{% if current_lang == 'en' %}active{% endif %}" href="{{ en_url | relative_url }}">EN</a>
            <span class="sep">|</span>
            <a class="{% if current_lang == 'zh' %}active{% endif %}" href="{{ zh_url | relative_url }}">中文</a>
        </div>
    </div>
</nav>
